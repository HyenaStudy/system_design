# 처리율 제한 장치 설계

## 1. 문제 상황 확인
1. 서버 측의 처리율 제한 장치(rate limiter, **이하 rl**)를 설계해야 한다
2. 처리율 제한 규칙은 유연해야 한다
3. 대규모 트래픽에도 견고해야 한다
4. 분산 환경에서 동작해야 한다
5. 예외 처리가 필요하다

## 2. 구현 전제 조건
### (1) 직접 구현할 경우 - JVM 계열 언어가 적합한가?
**rl의 매커니즘은 동기/비동기, 블로킹/논블로킹을 고려하지 않는다**
- I/O 요청의 동기/비동기 처리나, 핸들러의 블로킹/논블로킹 여하에 관련없이 rl은 입장 허용 여부만 판별
- 매장 오픈 전 문 앞 손님들이 질서있게 있든, 마구잡이로 몰려있든 매장 입구컷의 적용은 동일한 것처럼

**JVM은 원자적 연산(CAS)에 매우 강력하다**
- rl은 대부분 원자적 카운팅(증감 연산) 기반의 알고리즘
- `Atomic` 시리즈, `Lock` 인터페이스 구현체, `Concurrent` 시리즈처럼 원자 연산을 지원하는 자료구조가 풍부함

**서버 아키텍처의 확장에 구애받지 않는다: 대규모 트래픽에도 견고한 rl 세팅 가능**
- 모놀리스라면 Spring MVC의 필터나 인터셉터 단에 자연스럽게 세팅 가능
- 분산 마이크로서비스로 확장하면 Spring Cloud의 API Gateway에 세팅하는 것 또한 가능
- 다만 스케일 아웃으로 분산 환경까지 다다르면 직접 구현보다는 외부 서비스 기반 rl 세팅이 더 자연스러워질 것

### (2) 외부 서비스를 빌릴 경우 - 선택 기준이 무엇인가?

## 3. 처리율 제한 알고리즘
### (1) 토큰 버킷(token bucket)
### (2) 누출 버킷(leaky bucket)
### (3) 고정 윈도우 카운터(fixed window counter)
### (4) 이동 윈도우 로그(sliding window log)
### (5) 이동 윈도우 카운터(sliding window counter)

## 4. 분산 환경 고려
